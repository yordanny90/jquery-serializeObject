(function(){var A=/^([^\[]+)(\[(?:.|\n|\r)*\].*)$/,B=/^\[([^\]]*)\]((?:.|\n|\r)*)$/,C=/^[^\[]/,v=function(a){return String(a).replace(/^[ \t]+/,"")},w=function(a){return String(a).replace(/^[ \t]/,"")},x=function(a){var b=0;"object"===typeof a&&(b=Array.isArray(a)?a.length:$.extend([],a).length);return b},n=function(a,b,c){if(!Array.isArray(a)||0==a.length)return!1;var d=a.shift();""===w(d)&&(d=x(c));0==a.length?c[d]=b:("object"!==typeof c[d]&&(c[d]=[]),n(a,b,c[d]),Array.isArray(c[d])&&c[d].length!==
Object.keys(c[d]).length&&(c[d]=$.extend({},c[d])));return!0},y=function(a){a=v(a);if(!a.match(C))return null;var b,c=[];if(b=a.match(A))for(b[1]=b[1].replace(/[ \[]/g,"_"),c.push(b[1]),a=b[2];b=a.match(B);)c.push(b[1]),a=b[2];else{if(b=a.match(/([ \[])/))" "==b[1]?a=a.replace(/[ \[]/g,"_"):"["==b[1]&&(a=a.replace(/\[/g,"_"));c.push(a)}return c},p=function(a,b,c){if("string"!==typeof a||"undefined"===typeof b)return!1;a=y(a);if(!a)return!1;n(a,b,c);return!0},q=function(a){if(!(a instanceof FormData))return null;
var b={};$.each(Array.from(a.entries()),function(c,d){d[1]instanceof Object||p(d[0],d[1],b)});return b},r=function(a){if(!(a instanceof FormData))return null;var b=[];$.each(Array.from(a.entries()),function(c,d){d[1]instanceof File&&b.push({name:d[0],value:d[1]})});return b},k=function(a,b){b instanceof FormData||(b=new FormData);"object"===typeof a&&$.each(Array.from(a),function(c,d){"object"===typeof d&&"string"===typeof d.name&&""!==d.name&&(d.value instanceof File||"string"===typeof d.value||
"number"===typeof d.value)&&b.append(d.name,d.value)});return b},l=function(a){a=$(a).map(function(b,c){if($(c).is("form,fieldset"))return $(c.elements).get();if($(c).is(":input"))return c});return a=$(a.add().get())},t=function(a,b){a=l(a).filter(":enabled");var c=a.filter("[form2json-disabled]");c.prop("disabled",!0);try{b.call(a.filter(":input"))}catch(d){console.error(d)}finally{c.prop("disabled",!1)}};window.serializeObject_util={ltrim:v,ltrim_one:w,next_id:x,add_recursive:n,nameToList:y,add_form_item:p,
getElements:l};$.extend($.fn,{serializeObject:function(){var a={};$.each($(this).serializeArray(),function(b,c){p(c.name,c.value,a)});return a},serializeFiles:function(){var a=l(this).filter("[name]:file:enabled"),b=[];$.each(a,function(c,d){null!=d.name&&""!==d.name&&d.files&&$.each(d.files,function(h,g){b.push({name:d.name,value:g})})});return b},form2json:function(){return $(this).trigger("form2json")},serializeMakeFormData:function(a,b){var c=$(this).first();if(0==c.length||!c.is("form,fieldset"))return null;
(null==a||a)&&c.form2json();var d=null;t(c,function(){d=k($(this).serializeArray());b||(d=k($(this).serializeFiles(),d))});return d},serializeMakeArray:function(a){var b=$(this).first();if(0==b.length||!b.is("form,fieldset"))return null;(null==a||a)&&b.form2json();var c=null;t(b,function(){c=$(this).serializeArray()});return c},serializeMakeObject:function(a){var b=$(this).first();if(0==b.length||!b.is("form,fieldset"))return null;(null==a||a)&&b.form2json();var c=null;t(b,function(){c=$(this).serializeObject()});
return c}});$.extend($,{serializeObject_util:serializeObject_util,formData_getObject:q,formData_getArray:function(a){if(!(a instanceof FormData))return null;var b=[];$.each(Array.from(a.entries()),function(c,d){d[1]instanceof Object||b.push({name:d[0],value:d[1]})});return b},formData_getFiles:r,formData_intoJSONFile:function(a,b){if(!(a instanceof FormData))return null;if(null==b||""===(b=String(b)))b="__dataJSON__";var c=k(r(a));a=JSON.stringify(q(a));a=new File([a],"data.json",{type:"text/json"});
c.append(b,a);return c},formData_intoJSON:function(a,b){if(!(a instanceof FormData))return null;if(null==b||""===(b=String(b)))b="__dataJSON__";var c=k(r(a));a=JSON.stringify(q(a));c.append(b,a);return c},formData_fromArray:k,formData_merge:function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];a instanceof FormData||(a=new FormData);$.each(c,function(h,g){g instanceof FormData&&$.each(Array.from(g.entries()),function(u,e){a.append(e[0],e[1])})});return a}});var m=function(a,b,
c){c||(c=$());a=$(a);if(a.is("fieldset")){var d=a.parentsUntil("form","fieldset").last();d.length&&(a=d)}if(!c.filter(a).length){c=c.add(a);try{var h={},g=l(a).filter("[form2json]:input").not('[form2json=""]');g.each(function(e,f){e=$(f).attr("form2json");h[e]||(h[e]={form:document.getElementById(e),inputs:[]});h[e].inputs.push(f)});g.val("");$.each(h,function(e,f){e=$(f.form).filter("form,fieldset");f=$(f.inputs);if(e.length&&f.length)try{c=m(e,b,c)||c,f=f.filter(function(z,D){return""==D.value}),
f.length&&f.val(JSON.stringify(e.serializeMakeObject(!1)))}catch(z){console.error(z)}});var u=g.filter(function(e,f){return""==f.value});u.length&&console.debug("missing",u)}catch(e){console.error(e)}return c}};$(document).on("submit","form",function(a){$(this).form2json()});$(document).on("form2json","form",function(a){m(this,a)});$(document).on("form2json-fieldset","fieldset",function(a){a.stopPropagation();m(this,a)});$(document).on("form2json-input",":input[form2json]",function(a){var b=$(this);
var c=b.attr("form2json");null==c||""===c?b=void 0:(b.val(""),b=$(document.getElementById(c)),b=b.is("form,fieldset")?b:void 0);b&&m(b,a)})})();
